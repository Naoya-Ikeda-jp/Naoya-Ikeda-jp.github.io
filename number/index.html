<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>数字の壁ランナー</title>
  <style>
    body { margin: 0; overflow: hidden; background: #000; }
    #ui {
      position: absolute; top: 10px; left: 10px;
      color: white; font-family: sans-serif; font-size: 18px;
      background: rgba(0,0,0,0.4); padding: 8px; border-radius: 4px;
    }
  </style>
</head>
<body>
  <div id="ui">Score: <span id="score">0</span></div>
  <script type="module">
    import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.156.1/build/three.module.js";

    // --- 基本セットアップ ---
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x222222);

    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0, 8, 20);
    camera.lookAt(0, 0, -50);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // --- ライト ---
    scene.add(new THREE.AmbientLight(0xffffff, 0.6));
    const dirLight = new THREE.DirectionalLight(0xffffff, 1);
    dirLight.position.set(5, 10, 5);
    scene.add(dirLight);

    // --- プレイヤー ---
    const playerGeo = new THREE.BoxGeometry(1, 1, 1);
    const playerMat = new THREE.MeshStandardMaterial({ color: 0x3399ff });
    const player = new THREE.Mesh(playerGeo, playerMat);
    player.position.set(0, 0.5, 0);
    scene.add(player);

    // --- 床 ---
    const floorGeo = new THREE.PlaneGeometry(20, 200);
    const floorMat = new THREE.MeshStandardMaterial({ color: 0x333333 });
    const floor = new THREE.Mesh(floorGeo, floorMat);
    floor.rotation.x = -Math.PI/2;
    scene.add(floor);

    // --- 壁生成 ---
    function createWall(z, value) {
      const wallGeo = new THREE.BoxGeometry(5, 5, 0.5);
      const wallMat = new THREE.MeshStandardMaterial({ color: value > 0 ? 0x44ff44 : 0xff4444 });
      const wall = new THREE.Mesh(wallGeo, wallMat);
      wall.position.set(0, 2.5, z);
      wall.userData.value = value;
      scene.add(wall);
      return wall;
    }

    const walls = [
      createWall(-20, +10),
      createWall(-40, -5),
      createWall(-60, +20),
      createWall(-80, -10),
    ];

    // --- スコア ---
    let score = 0;
    function updateScore(v) {
      score += v;
      document.getElementById("score").textContent = score;
    }

    // --- キー入力 ---
    const keys = {};
    document.addEventListener("keydown", (e) => { keys[e.key] = true; });
    document.addEventListener("keyup", (e) => { keys[e.key] = false; });

    // --- アニメーションループ ---
    function animate() {
      requestAnimationFrame(animate);

      // 自動で前進
      player.position.z -= 0.1;

      // 左右移動
      if (keys["a"] || keys["ArrowLeft"]) player.position.x -= 0.1;
      if (keys["d"] || keys["ArrowRight"]) player.position.x += 0.1;

      // 壁と当たり判定
      walls.forEach(wall => {
        if (!wall.userData.hit && player.position.distanceTo(wall.position) < 3) {
          updateScore(wall.userData.value);
          wall.userData.hit = true;
          wall.material.color.set(0x888888);
        }
      });

      renderer.render(scene, camera);
    }
    animate();

    // --- リサイズ対応 ---
    window.addEventListener("resize", () => {
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
